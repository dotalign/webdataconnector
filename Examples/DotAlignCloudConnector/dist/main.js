(()=>{var e,t,a,n,o,r={300:(e,t)=>{"use strict";var a=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==a)return a;throw new Error("unable to locate global object")}();e.exports=t=a.fetch,a.fetch&&(t.default=a.fetch.bind(a)),t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response},710:(e,t,a)=>{const n=a(300),o=a(680);async function r(e,t){return(await n(e,{method:"GET",headers:{Authorization:"Bearer "+t}})).json()}async function c(e){var t=`https://login.microsoftonline.com/${e.tenant_id}/oauth2/v2.0/token`,a=`grant_type=${e.grant_type}&client_id=${e.client_id}&client_secret=${e.client_secret}&tenant_id=${e.tenant_id}&scope=${e.scope}`;return await async function(e,t){const a=await n(e,{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}});return console.log("Response: "),o.logObject(a),a.json()}(t,a)}async function s(e,t,a){for(var n=0,o=null;n<e;)try{o=await r(t,a);break}catch(t){if(console.log(t),++n==e)throw console.log(`Failed to get data after ${e} tries...`),{exception:t,response:o}}return o}async function i(e,t,a,n){for(var o=a.totalFetchCount,r=0,c=!0,i=[];c&&r<o;){var l=process.hrtime(),u=await n(e,a),d=null;try{d=await s(3,u,t);for(var p=0;p<d.data.length;p++)i.push(d.data[p])}catch(e){throw console.log(`And exception was encountered while fetching data. ${r} records fetched so far.`),e.fetched=r,e}c=d.are_more,a.skip+=a.take,r+=d.data.length;var m=process.hrtime(l),f=m[0],h=m[1];console.log(`Fetched ${d.page_start} to ${d.page_end} in ${f}.${h}s`)}return console.log(`Done...fetched ${r} records`),{fetched:r,data:i}}e.exports={fetchDC:async function(e,t,a){for(var n=await c(e),r=n.access_token,s=!1,l=0,u=e.baseUrl;!s;){t.skip=l;var d=null;try{var p=process.hrtime();d=await i(u,r,t,a);var m=process.hrtime(p);console.log(`Finished a run in ${m[0]} seconds. ${d.fetched} items were fetched.`),s=!0}catch(t){o.logObject(t),console.log(`An exception was encountered. Fetched ${t.fetched} so far.`),l=t.fetched,r=(n=await c(e)).access_token}}return d}}},157:e=>{e.exports={teamMemberFetchUrlCreator:async function(e,t){return`${e}/teams/${t.teamNumber}/members?Skip=${t.skip}&Take=${t.take}&IncludeHealthStats=${t.includeHealthStats}`},peopleFetchUrlCreator:async function(e,t){return`${e}/people?SourceTeam=${t.teamNumber}&Skip=${t.skip}&Take=${t.take}&IncludeDetailLevel=${t.detailLevel}`},contributorPeopleFetchUrlCreator:async function(e,t){var a=t.teamNumber,n=t.skip,o=t.take,r=t.detailLevel;return`${e}/users/${t.contributorKey}/people?SourceTeam=${a}&Skip=${n}&Take=${o}&IncludeDetailLevel=${r}`},contributorCompaniesFetchUrlCreator:async function(e,t){var a=t.teamNumber,n=t.skip,o=t.take,r=t.detailLevel;return`${e}/users/${t.contributorKey}/companies?SourceTeam=${a}&Skip=${n}&Take=${o}&IncludeDetailLevel=${r}`}}},680:e=>{async function t(e){console.log(JSON.stringify(e,null,5))}e.exports={logObject:t,asyncExecutor:async function(e,a,n){let o;try{o={success:!0,returnValue:await e(a,n)}}catch(e){t(e),o={success:!1,error:e,returnValue:null}}return o}}},225:(e,t,a)=>{const n=a(680);e.exports={getEnvironmentParams:function(){return params={baseUrl:"https://dotalign-obhnbxktkccdo-webapp.azurewebsites.net/api",tenant_id:"ef816895-7d31-42b9-a2e6-a2cc244e05c5",grant_type:"client_credentials",client_id:"f4ac093f-f62c-49c6-ad79-b84ac4fe79c1",client_secret:"5RzN~P7dF.irA5b8~dw3XUA.nLheXSb-Jg",scope:"128721d7-3cc6-44b0-97a2-b709323602af/.default"}},printPeople:async function(e){for(var t=0;t<e.length;t++){var a={name:e[t].PersonNameText,emailAddress:e[t].BestEmailAddrText,companyName:e[t].BestJobMatchedCompanyName,jobTitle:e[t].BestJobTitleText,bestIntroducer:e[t].BestKnowerNameText,phoneNumber:e[t].BestPhoneText,relationshipScore:e[t].WeKnowPersonScore};n.logObject(a)}},printTeamMembers:async function(e){for(var t=0;t<e.length;t++){var a={name:e[t].name,emailAddress:e[t].email,teamName:e[t].teamName,teamNumber:e[t].teamNumber};n.logObject(a)}}}}},c={};function s(e){if(c[e])return c[e].exports;var t=c[e]={exports:{}};return r[e](t,t.exports,s),t.exports}t=s(710),a=s(157),n=s(225),o=s(680),(e=tableau.makeConnector()).getSchema=function(e){e([{id:"People",alias:"People in the network",columns:[{id:"first_name",dataType:tableau.dataTypeEnum.string},{id:"last_name",alias:"last_name",dataType:tableau.dataTypeEnum.float},{id:"job_title",alias:"job_title",dataType:tableau.dataTypeEnum.string},{id:"company_name",dataType:tableau.dataTypeEnum.geometry},{id:"relationship_score",dataType:tableau.dataTypeEnum.int}]}])},e.getData=function(e,r){var c=n.getEnvironmentParams();console.log("Environment: "),o.logObject(c),async function(e,n,o,r,c){for(var s={teamNumber:1,skip:0,take:100,includeHealthStats:!1,totalFetchCount:5},i=await t.fetchDC(e,s,a.teamMemberFetchUrlCreator),l=[],u=0;u<i.data.length;u++){var d=i.data[u],p={teamNumber:1,skip:0,take:200,detailLevel:"IncludeDependentDetailsAndInteractionStats",totalFetchCount:100,contributorKey:d.userKey};console.log(`\n\nFetching people for ${d.userKey}`),console.log("-------");var m=await t.fetchDC(e,p,a.contributorPeopleFetchUrlCreator);console.log(`\nFetching companies for ${d.userKey}`),console.log("-------");var f=await t.fetchDC(e,p,a.contributorCompaniesFetchUrlCreator);d.userKey,l.push({contributor:d,people:m,companies:f})}return l}(c).then((e=>e)),e.appendRows([]),r()},tableau.registerConnector(e),$(document).ready((function(){$("#submitButton").click((function(){tableau.connectionName="DotAlign Cloud API",tableau.submit()}))}))})();